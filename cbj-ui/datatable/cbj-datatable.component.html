<div class="card" [ngClass]="config.cardClasses">

    <div *ngIf="config.multiData || config.title" class="dtTitle">
        <ng-container *ngIf="config.multiData; else singleTitle">
            <cbj-menu [options]="{arrow: true, title: false}" [items]="menuItems"></cbj-menu>
        </ng-container>
        <ng-template #singleTitle>
            <h4>{{config.title}}</h4>
        </ng-template>
    </div>

    <div class="dtTable" [ngClass]="config.classes">

        <div class="dtTable-row dtTable-header">
            <ng-container *ngFor="let col of columns">
                <ng-container *ngIf="!col.hidden">
                    <div class="dtTable-row-cell"
                         [ngStyle]="{'flex-grow': col.flex}"
                    >
                        {{col.name}}
                        <ng-container *ngIf="col.sortable">
                            <i *ngIf="col.sorted; else notSorted" class="material-icons md-1" [ngClass]="col.sortOrd === 'desc' ? 'down' : ''">arrow_upward</i>
                            <ng-template #notSorted>
                                <i class="material-icons md-1"></i>
                            </ng-template>
                        </ng-container>
                    </div>
                </ng-container>
            </ng-container>
            <ng-container *ngIf="colsHidden">
                <div class="dtTable-row-cell" [ngStyle]="{'flex-shrink': 1}">
                    More
                </div>
            </ng-container>
        </div>

        <div *ngFor="let row of visibleRows" class="dtTable-row">
            <ng-container *ngFor="let col of columns">
                <div *ngIf="!col.hidden"
                     class="dtTable-row-cell"
                     [ngStyle]="{'flex-grow': col.flex}">

                    <ng-container *ngIf="isString(col.data); else compCell">
                        <span [innerHTML]="row[col.data]"></span>
                    </ng-container>
                    <ng-template #compCell>
                        <ng-template [cbjCompCell]="{row: row, component: col.data, keys: col.keys}"></ng-template>
                    </ng-template>

                </div>
            </ng-container>
            <ng-container *ngIf="colsHidden">
                <div class="dtTable-row-cell">
                    <div class="toggler" (click)="row.cbjState = row.cbjState === 'closed' ? 'open' : 'closed'">
                        <i class="material-icons tiny">add_box</i>
                        More Columns
                    </div>
                </div>
                <div class="dtTable-row-hidden" [@collapse]="row.cbjState">
                    <ul class="cols-list">
                        <ng-container *ngFor="let col of columns">
                            <li *ngIf="col.hidden && isString(col.data)" class="col"><span class="col-name">{{col.name}}:</span>{{row[col.data]}}</li>
                        </ng-container>
                    </ul>
                </div>
            </ng-container>
        </div>

    </div>
</div>